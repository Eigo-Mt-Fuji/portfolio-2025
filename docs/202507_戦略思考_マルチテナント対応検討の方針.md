# 戦略思考 x マルチテナント対応検討

## やりたいこと

昨年学んだ、暗記する戦略思考をイメージしながら
既存サービスのマルチテナント対応検討の方針を考える

今回は、リアリティ・スイッチ x フチドリ思考で思考環境が整えてから、「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス、「そのまんま」を前提とする思考パスを使い


## 詳細

- テナント単位でリソースを割り当てる場合、特に現在アーキテクチャでの注意として、サーバには最小リソース要件があるので、中身が全く同一でも、分割するたびに費用と運用の効率が悪くなるという問題があります。
  - OSやミドルウェア、アプリケーション起動させ、維持するコストがそれぞれに発生するからです
- 一方のメリットとしては、顧客ごとにリソースが分離されることによるサービスレベルの向上や、トータルコストは同じでも、より多くのリソースをより多くのお金を落としてくれる顧客に配分できた場合、ビジネス上のパフォーマンスを高められます
- このようなテーマで議論する場合、もちろんアーキテクチャを変える選択肢もあります。しかし、労力とリスクが大きくなり、コストも上がる傾向があります
  - 例えば、従量課金性のサーバレスシステムを使ったり、教科書通りのマルチテナントアーキテクチャへの切り替えなどです
- アーキテクチャを変える前提で考えることもできそうですが、無視できない課題（例えば以下のような点）に直面し破綻する可能性もあります
    - 無視できない課題とは、コストや運用が犠牲にされたり、それを避けようとして逆にメリットが失われたり、最悪の場合作業量、スケジュール、リスクなどが許容範囲を超えて、実現性自体が失われることです
- これを踏まえると、重要な選択肢として、以下の２つの分岐があると考えられます。
    - トータルのインフラコストと運用負担を上げてでも、ショップテナント単位のリソース配分をやりたいのか、それとも、現状のまま実現したいのか
    - プラットフォームのアーキテクチャを大きく変更してでもやりたいのか、それともまず現状のまま直近で実現したいのか
- ただ、すでにサービスを運用している場合、現状を変えず、なるべく簡単に安く手に入るに越したことはないと考えます
- このことから
  - 現状を変えず、なるべく簡単に安く実現したい場合
    - コストと運用負担を維持し、現状のアーキテクチャのまま、特定顧客グループ（１社を含む）ごとにリソースを割り当てる仕組みを検討する
  - アーキテクチャ変更も辞さない、トータルのインフラコストと運用負担を上げてでも達成したい目標の場合
    - そもそもテナント単位でリソースを分けるのはどのような理由か
    - 最適な仕組みを考える場合どうなるかを考える
- どちらの場合にも関係するもう１つ重要な点として、達成したいビジネス目標によって手段が変わることもあリます。
    - ビジネス目標というのは例えば以下のようなものです。
        - 特定顧客の性能要求・特需に対応できるリソースを提供する
        - リソース配分調整を可能にし、コストパフォーマンス効率を最適化する
        - SLA/SLO、セキュリティ上の説明責任を達成しやすくするため、テナント単位で独立したリソースを提供する
- 合わせると
    - そもそもテナント単位でリソースを分けるのはどのような理由か(達成したいビジネス目標を具体的にする)
    - 現状を変えず、なるべく簡単に安く実現したい場合
        - コストと運用負担を維持し、現状のアーキテクチャのまま、特定顧客グループ（１社を含む）ごとにリソースを割り当てる仕組みを検討する
        - タスク定義を維持したまま、ECSクラスタとタスク配置戦略の調整による実現性の検討
    - アーキテクチャ変更も辞さない、トータルのインフラコストと運用負担を上げてでも達成したい目標の場合
        - 最適な仕組みを考える場合どうなるかを考える
## 備考: 暗記戦略思考のパターン

- リアリティ・スイッチ x フチドリ思考(思考環境が整う)
    - スイッチ01 大学1年生の英語留学っぽく考えてみると
    - スイッチ09 定員割れ大学問題っぽく考えてみると
- 調べるか、解くか、それとも顧客に質問するか
    - STEP1. 調べる vs 解く 
      - スイッチ07 フランススーパーっぽく考えてみる
- 一度、引いて考えてみる
    - STEP7. 課題が揃った時、一度、引いて考えてみる
        - スイッチ06 打倒セブンっぽく考えてみると(「本当に競合は誰か？」を考える。特に、目の前の敵は競合か？を疑う思考パス)
        - スイッチ12 年間パスポートっぽく考えてみると( そのまんま思考. 「最も難しく」考える。広告を打つ・単価を上げるといった飛び道具に頼るなどもっての外で「そのまんま」を前提とする思考パス )
- 「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス
    - あらゆる手段で調べたがまだわからない現実が存在する時
        - スイッチ11 すごい素材っぽく考えてみると ( 「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス )
- 現状把握。誰かに聞かないと議論しないとわからないことを見極める
    - 問題を解くための登場人物を把握する。
        - スイッチ04 コインランドリー参入問題っぽく考えてみると
        - スイッチ05 スギ花粉っぽく考えてみると
- 課題を発見する時の１つの指針。深く考える切り口。
    - スイッチ02 カインズっぽく考えてみると ( 誰が敵なのか 特に、消費者／ユーザーがお金を使うまでの「分岐」を詳らかにする思考パス )
    - スイッチ03 車の教習所っぽく考えてみると(どこがホームでどこがアウェイかを考える。 地理的／視覚的に「勝ちゲーム」か「負けゲーム」かを詳（つまび）らかにしていく思考パス )
    - スイッチ08 QBハウスっぽく考えてみると( ターゲットとの「距離」を考える。 「どの層がターゲットになりやすいか？」の序列をつける思考パス)
