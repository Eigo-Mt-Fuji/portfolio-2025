# 戦略思考 x 既存サービスのマルチテナント対応検討の進め方

## やりたいこと

昨年学んだ、暗記する戦略思考をイメージしながら
既存サービスのマルチテナント対応検討の進め方を考える

今回は、リアリティ・スイッチ x フチドリ思考で思考環境が整えてから、「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス、「そのまんま」を前提とする思考パスを使い

## 詳細

- 結論としては、既存サービスのマルチテナント対応検討の進め方は
    - まず、そもそもテナント単位でリソースを分けるのはどのような理由か。実際の狙いを確認するためのMTGを開催します
      - アウトプットは、たとえば以下のようなシンプルな達成したいことを箇条書きにし、強いて言えばどれが一番なのかを考えるというイメージです。
        - 特定顧客の性能要求・特需に対応できるリソースを提供する
        - リソース配分調整を可能にし、コストパフォーマンス効率を最適化する
        - SLA/SLO、セキュリティ上の説明責任を達成しやすくするため、テナント単位で独立したリソースを提供する
      - 進め方について検討した側としては、特定の顧客だけ需要が大きいので専用のリソースが割り当てたり、需要が顧客ごとにかなり違うので、ニーズに合わせて調節したり配分を調節したいのではと考えられます。この点も認識の相違がないか確認したいです
    - トータルのインフラコストと運用負担を上げてでも、ショップテナント単位のリソース配分をやりたいのか、それとも、現状のまま実現したいのかによって以下のように進め方を変える
      - 現状を変えず、なるべく簡単に安く実現したい場合
        - つまり、ゼロから作り直して、金と時間をかけて、システムを最適化すれば、マルチテナント対応のシステムに生まれ変わらせることはできるかもしれませんが、ビジネス目的なので、なるべく現状のアーキテクチャのまま、特定顧客グループ（１社を含む）ごとにリソースを割り当てたり、ニーズに合わせて調整できる仕組みを検討します
        - 具体的には、ECSタスクの構成を維持したまま、ECSクラスタのタスク配置戦略、オートスケーリングポリシーの調整による実現性の検討を進めます
      - 逆に、アーキテクチャ変更も辞さない、トータルのインフラコストと運用負担を上げてでも達成したい目標の場合
        - 目的に合わせて、最適な仕組みを考える場合どうなるかを考える
          - 適用先は、プロダクト全体か、特定のコンポーネントか。
          - 利用するプラットフォームや全体アーキテクチャから考え直す
          - そのために、よくある事例を調べたり、プランを作成し、比較する
- リアリティ・スイッチ x フチドリ思考
  - テナント単位でのリソース割り当ての具体的な特徴について考えてみると、
    - メリットとしては、顧客ごとにリソースが分離されることによるサービスレベルの向上や、トータルコストは同じでも、より多くのリソースをより多くのお金を落としてくれる顧客に配分できた場合、ビジネス上のパフォーマンスを高められます
    - デメリットとしては、テナント単位でリソースを割り当てる場合、特に現在アーキテクチャでの注意として、サーバには最小リソース要件があるので、中身が全く同一でも、分割するたびに費用と運用の効率が悪くなるという問題があります。
      - OSやミドルウェア、アプリケーション起動させ、維持するコストがそれぞれに発生するからです
    - 対応案を考えてみた場合、従量課金性のサーバレスシステムを使ったり、教科書通りのマルチテナントアーキテクチャへの切り替えなど、アーキテクチャを変える選択肢と、そうではなく現状のまま実現性を探る方向性の２種類があります
    - 教科書通りのマルチテナントアーキテクチャへの切り替えなどを行う場合、労力とリスクが大きくなり、コストも上がる傾向があります。かといって、現状のまま実現性を探ろうとすると、変更作業量と裏腹に難易度が高くなり、逆に高コストにもなり得ます。これらは内容次第です
    - 特にアーキテクチャを変える前提で考える場合は、ビジネス上、無視できない課題（例えば以下のような点）に直面し破綻する可能性もあります
      - 無視できない課題とは、コストや運用が犠牲にされたり、それを避けようとして逆にメリットが失われたり、最悪の場合作業量、スケジュール、リスクが許容範囲を超えて、実現性が失われること
    - マルチテナント対応を求められているのはそもそもなぜか(要確認)
      - マルチテナント対応と言っても、顧客ごとに専用のリソースを割り当てたいというよりは、特定の顧客だけ需要が大きいので専用のリソースが割り当てたり、ニーズに合わせて調節したい
      - テナント単位でリソースを割り当てるというよりは、需要が顧客ごとにかなり違うので、配分を調節したい
      - できれば、それぞれの顧客のインフラの独立させて管理しやすくする方法を探している

- 条件分岐を考える
  - これを踏まえると、重要な選択肢として、以下の２つの分岐があると考えられます。
    - トータルのインフラコストと運用負担を上げてでも、ショップテナント単位のリソース配分をやりたいのか、それとも、現状のまま実現したいのか
    - プラットフォームのアーキテクチャを大きく変更してでもやりたいのか、それともまず現状のまま直近で実現したいのか
  - そもそもなぜやりたいのか。達成したいビジネス目標によって手段が変わるので、目標を３つに分けて考えます
    - 特定顧客の性能要求・特需に対応できるリソースを提供する
    - リソース配分調整を可能にし、コストパフォーマンス効率を最適化する
    - SLA/SLO、セキュリティ上の説明責任を達成しやすくするため、テナント単位で独立したリソースを提供する

- そのまんま思考
  - ゼロから作り直して、金と時間をかけて、システムを最適化すれば、マルチテナント対応のシステムに生まれ変わらせることはできるかもしれません
  - お金に糸目をつけず、社運をかけて最適解を実現したい場合も確かにあります
  - しかし、ビジネス目的なら、マルチテナント対応によって利益を出すのが狙いのはず。
  - 特に、すでにサービスを運用している場合、なるべく簡単に安く手に入るに越したことはないはず。
  - ここでは、コストと運用、アーキテクチャを現状のままで、ECSクラスタとタスク配置戦略の調整による実現を考えます
    - 特定の顧客だけ需要が大きいので専用のリソースが割り当てたり、需要が顧客ごとにかなり違うので、ニーズに合わせて調節したり配分を調節したい

## 備考: 暗記戦略思考のパターン

- リアリティ・スイッチ x フチドリ思考(思考環境が整う)
    - スイッチ01 大学1年生の英語留学っぽく考えてみると
    - スイッチ09 定員割れ大学問題っぽく考えてみると
- 調べるか、解くか、それとも顧客に質問するか
    - STEP1. 調べる vs 解く 
      - スイッチ07 フランススーパーっぽく考えてみる
- 一度、引いて考えてみる
    - STEP7. 課題が揃った時、一度、引いて考えてみる
        - スイッチ06 打倒セブンっぽく考えてみると(「本当に競合は誰か？」を考える。特に、目の前の敵は競合か？を疑う思考パス)
        - スイッチ12 年間パスポートっぽく考えてみると( そのまんま思考. 「最も難しく」考える。広告を打つ・単価を上げるといった飛び道具に頼るなどもっての外で「そのまんま」を前提とする思考パス )
- 「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス
    - あらゆる手段で調べたがまだわからない現実が存在する時
        - スイッチ11 すごい素材っぽく考えてみると ( 「条件分岐」を考える。特に「戦略の方向性」が変わる条件を見極める思考パス )
- 現状把握。誰かに聞かないと議論しないとわからないことを見極める
    - 問題を解くための登場人物を把握する。
        - スイッチ04 コインランドリー参入問題っぽく考えてみると
        - スイッチ05 スギ花粉っぽく考えてみると
- 課題を発見する時の１つの指針。深く考える切り口。
    - スイッチ02 カインズっぽく考えてみると ( 誰が敵なのか 特に、消費者／ユーザーがお金を使うまでの「分岐」を詳らかにする思考パス )
    - スイッチ03 車の教習所っぽく考えてみると(どこがホームでどこがアウェイかを考える。 地理的／視覚的に「勝ちゲーム」か「負けゲーム」かを詳（つまび）らかにしていく思考パス )
    - スイッチ08 QBハウスっぽく考えてみると( ターゲットとの「距離」を考える。 「どの層がターゲットになりやすいか？」の序列をつける思考パス)
